<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.reiko.nail.dao.CustomerDao">

	<resultMap id="BaseMap" type="com.reiko.nail.entity.CustomerEntity">
		<id column="CUSTOMER_CD" property="customerCd" />
		<result column="CUSTOMER_SEI" property="customerSei" />
		<result column="CUSTOMER_MEI" property="customerMei" />
		<result column="SEI_FURIGANA" property="seiFurigana" />
		<result column="MEI_FURIGANA" property="meiFurigana" />
		<result column="YUBIN_NO" property="yubinNo" />
		<result column="PREFECTURE_CITY" property="prefectureCity" />
		<result column="STREET_NO" property="streetNo" />
		<result column="KOUNYU_KAISU" property="kounyuKaisu" />
		<result column="RUIKEI_KOUNYU_KINGAKU" property="ruikeiKounyuKingaku" />
		<result column="DELETE_FLAG" property="deleteFlag" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="UPDATE_DATE" property="updateDate" />
	</resultMap>
	
	<select id="findByCustomer" resultMap="BaseMap">
		SELECT 
			*
		FROM 
			CUSTOMER
		WHERE 
			CUSTOMER_CD = #{customerCd}
		AND
			DELETE_FLAG = '0'
	</select>
	
	<select id="selectByAllCustomer" resultMap="BaseMap">
		SELECT * FROM CUSTOMER WHERE DELETE_FLAG = '0'
	</select>
	
	<select id="countCustomer" resultType="int">
		SELECT
			COUNT(*)
		FROM
			CUSTOMER
	</select>
	
	<insert id="insertCustomer" parameterType="com.reiko.nail.entity.CustomerEntity">
		INSERT INTO CUSTOMER (
			CUSTOMER_CD, 
            CUSTOMER_SEI,
            CUSTOMER_MEI,
         	SEI_FURIGANA,
         	MEI_FURIGANA,
            YUBIN_NO,
            PREFECTURE_CITY,
            STREET_NO,
            RUIKEI_KOUNYU_KINGAKU,
            KOUNYU_KAISU,
            CREATE_DATE,
            UPDATE_DATE
		)VALUES(
            #{customerCd},
            #{customerSei},
            #{customerMei},
          	#{seiFurigana},
          	#{meiFurigana},
            #{yubinNo},
            #{prefectureCity},
            #{streetNo},
            '0',
            '0',
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
       )
	</insert>
	
	<update id="updateCustomerJohoAndKounyu">
		UPDATE 
			CUSTOMER
		SET
			CUSTOMER_SEI = #{customerSei},
			CUSTOMER_MEI = #{customerMei},
			SEI_FURIGANA = #{seiFurigana},
			MEI_FURIGANA = #{meiFurigana},
			YUBIN_NO = #{yubinNo},
			PREFECTURE_CITY = #{prefectureCity},
			STREET_NO = #{streetNo},
			KOUNYU_KAISU = KOUNYU_KAISU + 1,
			RUIKEI_KOUNYU_KINGAKU = RUIKEI_KOUNYU_KINGAKU + #{ruikeiKounyuKingaku},
			UPDATE_DATE = CURRENT_TIMESTAMP
		WHERE
			CUSTOMER_CD = #{customerCd}
	</update>
	
	<update id="updateCustomerKingakuJoho">
		UPDATE
			CUSTOMER
		SET
			KOUNYU_KAISU = KOUNYU_KAISU + 1,
			RUIKEI_KOUNYU_KINGAKU = RUIKEI_KOUNYU_KINGAKU + #{kounyuKngaku}
		WHERE
			CUSTOMER_CD = #{customerCd}
	</update>
	
	<update id="updateCustomerJoho">
		UPDATE
			CUSTOMER
		SET
			CUSTOMER_SEI = #{customerSei},
			CUSTOMER_MEI = #{customerMei},
			SEI_FURIGANA = #{seiFurigana},
			MEI_FURIGANA = #{meiFurigana},
			YUBIN_NO = #{yubinNo},
			PREFECTURE_CITY = #{prefectureCity},
			STREET_NO = #{streetNo},
			UPDATE_DATE = CURRENT_TIMESTAMP
		WHERE
			CUSTOMER_CD = #{customerCd}
	</update>
	
	<update id="deleteCustomerByPrimary">
		UPDATE 
			CUSTOMER 
		SET
			DELETE_FLAG = '1'
		WHERE 
			CUSTOMER_CD = #{customerCd}
	</update>

</mapper>