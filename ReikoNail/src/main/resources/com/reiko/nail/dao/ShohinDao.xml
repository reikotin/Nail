<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.reiko.nail.dao.ShohinDao">
	<resultMap id="BaseMap" type="com.reiko.nail.entity.ShohinEntity">
		<id column="SHOHIN_CD" property="shohinCd" />
		<result column="THEME_TYPE" property="themeType" />
		<result column="SEASON" property="season" />
		<result column="ZEINUKIGAKU" property="zeinukiGaku" />
		<result column="ZEIGAKU" property="zeiGaku" />
		<result column="ZEIKOMIGAKU" property="zeikomiGaku" />
		<result column="MAKE_TIME" property="makeTime" />
		<result column="SHIIRE_ID_LIST" property="shiireIdList" />
		<result column="SHOHIN_MEMO" property="shohinMemo" />
		<result column="DELETE_FLAG" property="deleteFlag" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="UPDATE_DATE" property="updateDate" />
	</resultMap>

	<select id="selectAllShohinList" resultMap="BaseMap">
		SELECT * 
		FROM 
			N_SHOHIN 
		WHERE 
			DELETE_FLAG = '0'
		ORDER BY
			UPDATE_DATE DESC
	</select>
	
	<select id="selectByShohinKingaku">
		SELECT
			ZEINUKIGAKU,
			ZEIGAKU,
			ZEIKOMIGAKU
		FROM 
			N_SHOHIN
		WHERE
			SHOHIN_CD = #{shohinCd}
		AND DELETE_FLAG = '0'
	</select>
	
	<!-- TODO ItemIndex -->
	<select id="searchItemList" resultMap="BaseMap">
		SELECT 
			*
		FROM 
			N_SHOHIN
		WHERE 
			DELETE_FLAG = '0'
		<if test="themeType != null">
			AND THEME_TYPE = #{themeType}
		</if>
		<if test="seasonCd != null">
			AND SEASON = #{seasonCd}
		</if>
	</select>
	
	<select id="findThemeAndSeason" resultType="string">
		SELECT 
			SHOHIN_CD
		FROM
			N_SHOHIN
		WHERE
			THEME_TYPE = #{themeType}
		AND
			SEASON = #{seasonCd}
		ORDER BY 
			SHOHIN_CD DESC
		LIMIT 1
	</select>
	
	<insert id="insertNewItem">
		INSERT INTO N_SHOHIN(
			SHOHIN_CD,
			THEME_TYPE,
			SEASON,
			ZEINUKIGAKU,
			ZEIGAKU,
			ZEIKOMIGAKU,
		<if test="shiireIdList != null">
			SHIIRE_ID_LIST,
		</if>
		<if test="makeTime != null">
			MAKE_TIME,
		</if>
		<if test="shohinMemo != null">
			SHOHIN_MEMO,
		</if>
			DELETE_FLAG,
			CREATE_DATE,
			UPDATE_DATE
		) VALUES (
			#{shohinCd},
			#{themeType},
			#{season},
			#{zeinukiGaku},
			#{zeiGaku},
			#{zeikomiGaku},
		<if test="shiireIdList != null">
			#{shiireIdList},
		</if>
		<if test="makeTime != null">
			#{makeTime},
		</if>
		<if test="shohinMemo != null">
			#{shohinMemo},
		</if>
			'0',
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
		)
	</insert>
	
	<update id="deleteShohin">
		UPDATE N_SHOHIN
		SET
			DELETE_FLAG = '1'	
		WHERE 
			SHOHIN_CD = #{shohinCd}
		AND DELETE_FLAG = '0'
	</update>
	
	<update id="ikkatsuDeleteShohin">
		UPDATE N_SHOHIN
		SET
			DELETE_FLAG = '1'
		WHERE
			SHOHIN_CD IN
		<foreach collection="requests" item="requests" open="(" close=")" separator=",">
			#{requests.shohinCd}
		</foreach>
	
	</update>
	
	<select id="findByShohin" resultMap="BaseMap">
		SELECT *
		FROM
			N_SHOHIN
		WHERE 
			SHOHIN_CD = #{shohinCd}
		AND 
			DELETE_FLAG = '0'
	</select>
	
	<update id="updateShohin">
		UPDATE N_SHOHIN
		SET
		<if test="zeinukiGaku != null">
			ZEINUKIGAKU = #{zeinukiGaku},
		</if>
		<if test="zeiGaku != null">
			ZEIGAKU = #{zeiGaku},
		</if> 
		<if test="zeikomiGaku != null">
			ZEIKOMIGAKU = #{zeikomiGaku},
		</if>
		<if test="makeTime != null">
			MAKE_TIME = #{makeTime},
		</if>
		<if test="shiireIdList != null">
			SHIIRE_ID_LIST = #{shiireIdList},
		</if>
		<if test="shohinMemo != null">
			SHOHIN_MEMO = #{shohinMemo},
		</if>
		UPDATE_DATE = CURRENT_TIMESTAMP
		WHERE
			SHOHIN_CD = #{shohinCd}
		AND DELETE_FLAG = '0'
	</update>
	
	<select id="selectRelationToTheme" resultType="string">
		SELECT 
			SEASON
		FROM
			N_SHOHIN
		WHERE
			DELETE_FLAG = '0'
		AND
			THEME_TYPE = #{themeType}
		GROUP BY SEASON
	</select>
</mapper>