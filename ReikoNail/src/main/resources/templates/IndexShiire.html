<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet" type="text/css">
    <title>R-ネイル | 仕入一覧</title>
</head>
<body>
    <div class="container-fluid">
      <div class="row he-1">
        <div th:replace="~{fragments/side :: nav}"></div>
        <main class="col-md-9 ml-sm-auto col-lg-10 bg-light">
          <div class="container r-w">
            <div class="d-flex justify-content-between align-items-center border-bottom border-dark mt-3">
              <h1 class="h1">R-ネイル : 仕入一覧</h1><div id="message-container"><span th:if="${message}" th:text="${message}"></span></div>
              <h6 class="">システム日付 : <span id="clock"></span></h6>
            </div>
          </div>
          <div class="container r-w mtmb-2">
            <div>
              <form method="POST" th:object="${searchShiire}" th:action="@{/IndexShiire}" id="form">
				<input type="hidden" th:field="*{number}">
                <div class="d-flex mb-3">
                  <div class="col-sm-3 me-3">
                    <label for="daiBunruiName">大分類名</label>
                    <select class="form-select" th:field="*{daiBunruiName}">
						<option value=''></option>
						<option th:each="daiBunrui : ${daiBunruiList}" th:value="${daiBunrui.bunruiName}" th:text="${daiBunrui.bunruiName}" />
					</select>
                  </div>
                  <div class="col-sm-3 me-3" style="position: relative; left: 25px;">
					<label for="shoBunruiName">小分類名</label>
                    <select th:field="*{shoBunruiName}" class="form-select">
						<option value=''></option>
						<option th:each="shoBunrui : ${shoBunruiList}" th:value="${shoBunrui.bunruiName}" th:text="${shoBunrui.bunruiName}"/>
					</select>
				  </div>
				  <div class="col-sm-3" style="position: relative; left: 50px;">
					  <label for="itemName">アイテム名<span class="ms-2 bubunitti">部分一致</span></label>
					  <input type="text" th:field="*{itemName}" class="form-control">
				  </div>
	           </div>
	           <div class="d-flex">
				   <div>仕入範囲</div>
			   </div>
	           <div class="d-flex mb-3">
	             <div class="col-sm-3 me-3">
				   <input type="Date" name="startDate" id="startDate" class="form-control">
	             </div>
	             <div class="me-3">
		            <div class="">~</div>
				 </div>
	             <div class="col-sm-3 me-3">
				   <input type="Date" name="endDate" id="endDate" class="form-control">
	             </div>
	             <div class="col" style="position: relative; left: 25px;">
	               <button type="submit" class="btn btn-secondary">
	                    検索
	               </button>
	             </div>
			   </div>
              </form>
            </div>
            <div class="col">
              <span th:if="${count}" th:text="${count}"></span>
            </div>
            <table class="table table-bordered text-center">
              <thead>
                  <tr>
					  <th>履歴ID</th>
                      <th>大分類名</th>
                      <th>小分類名</th>
                      <th>アイテム名</th>
                      <th>仕入額</th>
                      <th>仕入先</th>
                      <th>最終仕入日</th>
                  </tr>
              </thead>
              <tbody>
                <tr th:each="shiire: ${shiireList}">
                  <td>
                    <a class="text-decoration-none" th:href="@{/EditShiire/{id}(id=${shiire.rirekiId})}">
                      <span th:text="${shiire.rirekiId}"></span>
                    </a>
                  </td>
                  <td th:text="${shiire.daiBunruiName}"></td>
                  <td th:text="${shiire.shoBunruiName}"></td>
                  <td th:text="${shiire.itemName}"></td>
                  <td th:text="${#numbers.formatInteger(shiire.zeikomiGaku, 3, 'COMMA')}"></td>
                  <td th:text="${shiire.shiireSaki}"></td>
                  <td th:text="${shiire.updateDate}"></td>
                </tr>
              </tbody>
            </table>
		    <div th:if="${test}">
		        <div id="pages" th:if="${totalPages > 0}">
		        	<span th:each="pageNumber : ${#numbers.sequence(1, totalPages)}">
		            	<button type="button" th:value="${pageNumber}" th:id="'pageNum_' + ${pageNumber}"
						th:text="${pageNumber}" class="btn btn-outline-primary"></button>
		        	</span>
				</div>
		    </div>
          </div>
        </main>
      </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" crossorigin="anonymous"></script>
    <script th:inline="javascript">
		
	  function updateClock() {
	      var now = new Date();
	      var formattedTime = now.toLocaleString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
	      document.getElementById('clock').innerText = formattedTime;
	  }
	  updateClock();
	  setInterval(updateClock, 1000);
	  
	$(document).ready(function () {
		
		var btn = /*[[${currentNum}]]*/'';
		if(btn === '' || btn === 0){
			$('#pageNum_1').attr('class', 'btn btn-primary');
		}
		$('#pageNum_' + btn).attr('class', 'btn btn-primary');
		
		var kensakuWords = /*[[${kensakuWords}]]*/ []; 
		$('#daiBunruiName').val(kensakuWords.daiBunruiName);
		$('#shoBunruiName').val(kensakuWords.shoBunruiName);
		$('#startDate').val(kensakuWords.startDate);
		$('#endDate').val(kensakuWords.endDate);
		$('#itemName').val(kensakuWords.itemName);
		
		$('#pages').on('click', 'button[id^="pageNum_"]', function(){
			var num = $(this).attr('id').split('_')[1];
			console.log(num);
			$('#number').val(num);
			$('#form').submit();
		});
		
		$('#daiBunruiName').on('change', function(){
			var selectDaiBunruiName = $(this).val();
			if(selectDaiBunruiName === ''){
				$('#shoBunruiName').prop('disabled', true);
				$('#shoBunruiName').val('');
				return;
			}
			$.ajax({
				url: '/GetShoBunrui',
				type: 'GET',
				data: {
					daiBunruiName : selectDaiBunruiName,
					searchKbn: '1'
				},
				success: function(data){
					updateShoBunruiOptions(data);
				},error: function(){
					
				}
			});
		});
		function updateShoBunruiOptions(shoBunruiList) {
			var selectBox = $('#shoBunruiName');
            selectBox.empty();  // Clear existing options

            if(shoBunruiList.length > 0){
				$('#shoBunruiName').prop('disabled', false);
			}
            for (var i = 0; i < shoBunruiList.length; i++) {
				var option = $('<option>').val(shoBunruiList[i].bunruiName).text(shoBunruiList[i].bunruiName);
                selectBox.append(option);
             }
        } 
            
        $('#startDate').change(function(){
			 var startDate = $('#startDate').val();
			 $('#endDate').prop('min', startDate);
		 });
		$('input[type=date]').on('change', function() {
                // 入力がある場合は文字色を黒に、入力がない場合は白に変更
            $(this).css('color', $(this).val() ? 'black' : 'white');
        });
        
        
    });
   // $(document).ready(function() {
     // $('#zeinuki1, #zeinuki2').on('input', function() {
        // 数値以外を取り除く
       // let inputValue = $(this).val().replace(/[^0-9０-９]/g, '');
        // 全角数値を半角に変換する
       // inputValue = inputValue.replace(/[０-９]/g, function(s) {
         // return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
       // });
        // 値をセット
       // $(this).val(inputValue);
     // });
   // });
	</script>
</body>
</html>